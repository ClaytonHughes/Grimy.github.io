<meta charset=UTF-8>
<title>ZFarm</title>
<style>
body { background: #E6E6E6; color: #333; font-size: 1.1em }
* { box-sizing: border-box }
fieldset {
	padding: 20px; width: 40rem; border: 1px solid #04B; border-radius: 8px; background: #EEE;
	-webkit-box-shadow: 0 3px 5px rgba(0,0,0,.4); box-shadow: 0 3px 5px rgba(0,0,0,.4);
}
legend { font-size: 1.3rem }
legend, h1 { color: #04B }
label {
	display: block; margin: 1ex .25em;
	text-decoration: underline dotted; cursor: help;
}
input, select { width: 50%; margin: 0 }
form {
	width: 80%;
	margin: 0 auto;
	display: flex;
	flex-flow: row wrap;
	justify-content: space-between;
}
h1, button { display: block; width: 400px; margin: 30px auto }
button {
	padding: 0; cursor: pointer;
	-webkit-transition: background-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;
	-o-transition: background-color ease-in-out .15s, box-shadow ease-in-out .15s;
	transition: background-color ease-in-out .15s, box-shadow ease-in-out .15s;
	background-color: #06F; color: #EEE; height: 2.2em; font-size: 1.4em;
	border: 1px solid rgba(0, 0, 0, .4); border-radius: 4px;
}
button:hover  { background-color: #05D }
button:active { background-color: #04B; -webkit-box-shadow: inset 0 3px 5px rgba(0,0,0,.4); box-shadow: inset 0 3px 5px rgba(0,0,0,.4) }
</style>

<h1>Where should I farm?</h1>

<p>Warning: this calculator is currently in beta-test, results may be off.</p>

<form action='#'>
	<fieldset>

		<legend>Inputs</legend>

		<label title='Your minimum attack, in the stance you use for farming'>
			<input type=text id=attack value=80Qi>
			Min ATK
		</label>

		<label title='Biome of the maps you create'>
			<select id=biome>
				<option value=gardens>Garden</option>
				<option value=mountain>Mountain</option>
				<option value=depths>Depths</option>
				<option value=forest>Forest</option>
				<option value=sea>Sea</option>
			</select>
			Biome
		</label>

		<label title='Total number of map imp-orts you have unlocked'>
			<input type=text id=imports value=5 pattern='[0-5]'>
			Map imp-orts
		</label>

		<label title='Check if you have unlocked the Titimp imp-ort'>
			<input type=checkbox checked id=titimp>
			Unlocked titimp?
		</label>

		<label title='Level of your Agility perk (max 20)'>
			<input type=text id=agility value=20 pattern='1?\d|20'>
			Agility
		</label>

		<label title='Level of your Range perk (max 10)'>
			<input type=text id=range value=10 pattern='\d|10'>
			Range
		</label>

		<label title='Critical hit chance, as displayed in the damage breakdown (max 80)'>
			<input type=text id=crit_chance value=50 pattern='[1-7]?\d|80'>
			Crit chance
		</label>

		<label title='Bonus critical damage, as displayed in the damage breakdown'>
			<input type=text id=crit_damage value=400>
			Crit damage%
		</label>

		<label title='Maximum size of the maps you create'>
			<input type=text id=size value=30 pattern='\d\d'>
			Map size
		</label>

		<label title='Maximum difficulty of the maps you create'>
			<input type=text id=difficulty value=84 pattern='\d+'>
			Map difficulty%
		</label>

		<label title='Level of your Overkill perk (max 30)'>
			<input type=text id=overkill value=0 pattern='[12]?\d|30'>
			Overkill
		</label>

		<label title='Check if you have unlocked the Hyperspeed mastery'>
			<input type=checkbox id=hyperspeed>
			Hyperspeed?
		</label>

		<button type=submit onclick='main()'>Recalculate</button>
	</fieldset>

	<fieldset>
		<legend>Results</legend>
		<div id=results></div>
	</fieldset>
</form>

<script src=zfarm.js></script>
<script>
function $(str) { return document.querySelector(str); }

function parse_suffixes(str) {
	var suffixes = [
		'(?!)', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc',
		'Ud', 'Dd', 'Td', 'Qad', 'Qid', 'Sxd', 'Spd', 'Od', 'Nd', 'V',
		'Uv', 'Dv', 'Tv', 'Qav', 'Qiv', 'Sxv', 'Spv', 'Ov', 'Nv', 'Tt',
	].map((x) => x.toLowerCase());
	suffixes.reverse();
	var regex = new RegExp(suffixes.join('|'), 'i');
	suffixes.reverse();
	return parseFloat(str.replace(regex, (x) => "E" + suffixes.indexOf(x) * 3));
}

function parse_inputs() {
	return {
		agility: 10 * Math.pow(.95, $('#agility').value),
		atk: parse_suffixes($('#attack').value.toLowerCase()),
		biome: biomes.all.concat(biomes[$('#biome').value]),
		cc: $('#crit_chance').value / 100,
		cd: 1 + $('#crit_damage').value / 100,
		difficulty: $('#difficulty').value / 100,
		hyperspeed: $('#hyperspeed').checked,
		import_chance: $('#imports').value * .03,
		overkill: $('#overkill').value * .005,
		range: 120 / (80 + 2 * $('#range').value) - 1,
		size: $('#size').value,
		titimp: $('#titimp').checked,
	}
}

function main() {
	$("#results").innerHTML = display(stats(parse_inputs()));
}

main();
</script>
