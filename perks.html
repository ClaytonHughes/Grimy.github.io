<meta charset=UTF-8>
<title>Grim’s Perks Calculator</title>
<style>
body { background: #E6E6E6; color: #333; font-size: 1.1em }
* { box-sizing: border-box }
fieldset {
	padding: 20px; width: 40rem; border: 1px solid #04B; border-radius: 8px; background: #EEE;
	-webkit-box-shadow: 0 3px 5px rgba(0,0,0,.4); box-shadow: 0 3px 5px rgba(0,0,0,.4);
}
legend { font-size: 1.3rem }
legend, h1 { color: #04B }
label {
	display: block; margin: 1ex .25em;
	text-decoration: underline dotted; cursor: help;
}
input, select { width: 50%; margin: 0 }
form {
	width: 80%;
	margin: 0 auto;
	display: flex;
	flex-flow: row wrap;
	justify-content: space-between;
}
h1, button { display: block; width: 400px; margin: 30px auto }
button {
	padding: 0; cursor: pointer;
	-webkit-transition: background-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;
	-o-transition: background-color ease-in-out .15s, box-shadow ease-in-out .15s;
	transition: background-color ease-in-out .15s, box-shadow ease-in-out .15s;
	background-color: #06F; color: #EEE; height: 2.2em; font-size: 1.4em;
	border: 1px solid rgba(0, 0, 0, .4); border-radius: 4px;
}
button:hover  { background-color: #05D }
button:active { background-color: #04B; -webkit-box-shadow: inset 0 3px 5px rgba(0,0,0,.4); box-shadow: inset 0 3px 5px rgba(0,0,0,.4) }

#advanced:not(:target) ~ label { display: none }
</style>

<h1>Grim’s Perks Calculator</h1>

<p>This calculator is in early testing. Sorry for the ugly results screen!

<form action='javascript://0'>
	<fieldset>
		<legend>Inputs</legend>

		<label title='Total Helium Earned, as displayed on the Stats screen'>
			<input type=text id=helium required>
			Total Helium
		</label>

		<label title='The zone on which you plan to do your Void Maps'>
			<input type=text id=zone onchange='set_zone()' required pattern='\d{2,3}'>
			VM zone
		</label>

		<label title='The latest perk you have unlocked'>
			<select id=unlock>
				<option value=loot2>Looting II</option>
				<option value=carp2>Carpentry II</option>
				<option value=moti2>Motivation II</option>
				<option value=power2>Power II</option>
				<option value=tough2>Toughness II</option>
				<option value=ok>Overkill</option>
				<option value=reso>Resourceful</option>
				<option value=coord>Coordinated</option>
				<option value=sipho>Siphonology</option>
				<option value=anti>Anticipation</option>
				<option value=resi>Resilience</option>
				<option value=medit>Meditation</option>
				<option value=relent>Relentlessness</option>
				<option value=carp>Carpentry</option>
				<option value=arti>Artisanistry</option>
				<option value=range>Range</option>
				<option value=agility>Base perks only</option>
			</select>
			Last unlock
		</label>

		<label title='How much you value +1% Helium income'>
			<input type=text id=weight-he value=7>
			Weight: Helium
		</label>

		<label title='How much you value +1% attack'>
			<input type=text id=weight-atk value=3>
			Weight: Attack
		</label>

		<label title='How much you value +1% survivability (health and block)'>
			<input type=text id=weight-hp value=1>
			Weight: Health
		</label>

		<label title='How much you value +1% overkill damage'>
			<input type=text id=weight-ok value=1>
			Weight: Overkill
		</label>

		<label title='How much you value +1% breeding speed. When set to 0, breed speed is converted into health using geneticists.'>
			<input type=text id=weight-breed value=0>
			Weight: Breed
		</label>

		<a id=advanced href='#advanced'>Advanced options (you probably shouldn’t bother with those)</a>

		<label title='Uncheck this if you didn’t unlock the Whipimp'>
			<input type=checkbox checked id=whipimp>
			Whipimp
		</label>

		<label title='Uncheck this if you didn’t unlock the Magnimp'>
			<input type=checkbox checked id=magnimp>
			Magnimp
		</label>

		<label title='Uncheck this if you didn’t unlock the Tauntimp'>
			<input type=checkbox checked id=tauntimp>
			Tauntimp
		</label>

		<label title='Uncheck this if you didn’t unlock the Venimp'>
			<input type=checkbox checked id=venimp>
			Venimp
		</label>

		<label title='Multiplier for Chronoimp/Jestimp loot.
Set to 0 if you haven’t unlocked these imps, 2 for Chrono, 3 for Jest or 5 for both.'>
			<input type=text id=chronojest value=5>
			Chrono/Jest
		</label>

		<label title='Multiplier for all non-Helium loot.
This should only account for low map level penalty, scrying, golden maps and challenges.
The other modifiers are handled by the code.'>
			<input type=text id=loot value='1'>
			Loot multiplier
		</label>

		<label title='Fraction of farm time spent with an active turkimp.
0 = never, 1 = always, 1.5 = always + Turkimp Tamer III.'>
			<input type=text id=turkimp value='0.5'>
			Turkimp
		</label>

		<label title='Your usual breed timer'>
			<input type=text id=breed-timer value=30>
			Breed timer
		</label>

		<label title='Average number of coordinations you get from a gigastation'>
			<input type=text id=giga value=1>
			Coords per giga
		</label>

		<label title='Used in max pop calculations.
Increasing this reduces the importance of Carp, Resourceful and Trumps.'>
			<input type=text id=housing value=3>
			Housing thingy
		</label>

		<button onclick='display(optimize(parse_inputs()))'>Optimize!</button>
	</fieldset>

	<fieldset>
		<legend>Results</legend>
		<div id=result></div>
	</fieldset>
</form>

<script src=perks.js></script>
<script>
const suffixes = [
	'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc',
	'Ud', 'Dd', 'Td', 'Qad', 'Qid', 'Sxd', 'Spd', 'Od', 'Nd', 'V',
	'Uv', 'Dv', 'Tv', 'Qav', 'Qiv', 'Sxv', 'Spv', 'Ov', 'Nv', 'Tt',
];

function $(str) { return document.querySelector(str); }

function parse_suffixes(str) {
	for (var i = suffixes.length; i > 0; --i)
		str = str.replace(' ', '').replace(new RegExp(suffixes[i - 1], 'i'), `E${3 * i}`)
	return parseFloat(str);
}

function input(id) {
	return parse_suffixes($('#' + id).value.toLowerCase());
}

function set_zone() {
	var zone = parseInt($('#zone').value);
	$('#weight-ok').parentNode.style.display = zone > 170 ? '' : 'none';
	$('#unlock').value =
		zone > 200 ? 'loot2' :
		zone > 170 ? 'ok' :
		zone > 150 ? 'reso' :
		zone > 120 ? 'coord' :
		zone > 115 ? 'sipho' :
		zone >  70 ? 'anti' :
		zone >  60 ? 'resi' :
		zone >  45 ? 'medit' :
		zone >  35 ? 'carp' :
		zone >  33 ? 'relent' :
		zone >  25 ? 'arti' :
		zone >  20 ? 'range' :
		             'agility';

	$('#weight-breed').value = zone > 70 ? 0 : 1;
}

const parse_inputs = () => ({
	helium: input('helium'),
	zone: parseInt($('#zone').value),
	last_unlock: $('#unlock').value,
	weight: {
		helium: input('weight-he'),
		attack: input('weight-atk'),
		health: input('weight-hp'),
		overkill: input('weight-ok'),
		breed: input('weight-breed'),
	},
	mod: {
		storage: 0.02,
		whip: $('#whipimp').checked,
		magn: $('#magnimp').checked,
		taunt: $('#tauntimp').checked,
		ven: $('#venimp').checked,
		chronojest: input('chronojest'),
		loot: input('loot'),
		turkimp: input('turkimp'),
		breed_timer: input('breed-timer'),
		giga: input('giga'),
		housing: input('housing'),
	}
});

function prettify(number) {
	if (number < 10000)
		return Math.round(number);
	let unit = -1;
	while (number > 1000)
		number /= 1000, ++unit;
	return number.toFixed((number < 10) + (number < 100)) + suffixes[unit];
}

function display(level) {
	$('#result').innerHTML = '';
	for (perk in level)
		if (level[perk] != 0)
			$('#result').innerHTML += '<p>' + perk + ': ' + level[perk];
}

set_zone();

</script>
