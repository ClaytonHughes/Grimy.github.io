<meta charset=UTF-8>
<title>Perk Optimizer</title>
<link rel=stylesheet href='grim.css'>
<style>
body { font-size: 1.1em }
label { display: block; margin: 1ex .25em }
input, select { width: 50%; margin: 0 }

#advanced:not(:target) ~ label { display: none }
#perks { width: 50rem; align-self: center }
#perks, .perk { border: 1px solid black }
.perk { flex: 0 0 20%; text-align: center; padding: 0.5ex 0; color: white }
.perk { background-color: grey }
.perk.tier2 { background-color: #809080 }
.perk.capped { background-color: #696980 }
</style>

<h1>Perk Optimizer</h1>

<p class=ko id=warning>Warning: the default weights aren’t great for late-game
He/hr. If you’re not doing a deep run, you should massively increase “Weight:
Helium” (90 seems to work well). You may also want to try
<a href='https://docs.google.com/spreadsheets/d/16JjhHQ3fpoXe-r5Az66tx1RM5GPTdDiwvA3_g12geJE/edit'>nsheetz’s calculator</a>.

<form class=flexbox action='javascript://0'>
	<fieldset>
		<legend>Inputs</legend>

		<label title='Total Helium Earned, as displayed on the Stats screen'>
			<input type=text id=helium value=10B required>
			Total Helium
		</label>

		<label title='The zone on which you plan to do your Void Maps'>
			<input type=text id=zone value=210 onchange='set_zone()' required pattern='\d{2,3}'>
			VM zone
		</label>

		<label title='The latest perk you have unlocked'>
			<select id=unlock>
				<option value=loot2>Looting II</option>
				<option value=carp2>Carpentry II</option>
				<option value=moti2>Motivation II</option>
				<option value=power2>Power II</option>
				<option value=tough2>Toughness II</option>
				<option value=ok>Overkill</option>
				<option value=reso>Resourceful</option>
				<option value=coord>Coordinated</option>
				<option value=sipho>Siphonology</option>
				<option value=anti>Anticipation</option>
				<option value=resi>Resilience</option>
				<option value=medit>Meditation</option>
				<option value=relent>Relentlessness</option>
				<option value=carp>Carpentry</option>
				<option value=arti>Artisanistry</option>
				<option value=range>Range</option>
				<option value=agility>Base perks only</option>
			</select>
			Last unlock
		</label>

		<label title='How much you value +1% Helium income'>
			<input type=text id=weight-he value=7>
			Weight: Helium
		</label>

		<label title='How much you value +1% attack'>
			<input type=text id=weight-atk value=3>
			Weight: Attack
		</label>

		<label title='How much you value +1% survivability (health and block)'>
			<input type=text id=weight-hp value=1>
			Weight: Health
		</label>

		<label title='How much you value +1% overkill damage'>
			<input type=text id=weight-ok value=1>
			Weight: Overkill
		</label>

		<label title='How much you value +1% breeding speed. When set to 0, breed speed is converted into health using geneticists.'>
			<input type=text id=weight-breed value=0>
			Weight: Breed
		</label>

		<p><a id=advanced href='#advanced'>Advanced options (you probably shouldn’t bother with those)</a>

		<label title='Uncheck this if you didn’t unlock the Whipimp'>
			<input type=checkbox checked id=whipimp>
			Whipimp
		</label>

		<label title='Uncheck this if you didn’t unlock the Magnimp'>
			<input type=checkbox checked id=magnimp>
			Magnimp
		</label>

		<label title='Uncheck this if you didn’t unlock the Tauntimp'>
			<input type=checkbox checked id=tauntimp>
			Tauntimp
		</label>

		<label title='Uncheck this if you didn’t unlock the Venimp'>
			<input type=checkbox checked id=venimp>
			Venimp
		</label>

		<label title='Multiplier for Chronoimp/Jestimp loot.
Set to 0 if you haven’t unlocked these imps, 2 for Chrono, 3 for Jest or 5 for both.'>
			<input type=text id=chronojest value=5>
			Chrono/Jest
		</label>

		<label title='Multiplier for all non-Helium loot.
This should only account for low map level penalty, scrying, golden maps and challenges.
The other modifiers are handled by the code.'>
			<input type=text id=loot value='1'>
			Loot multiplier
		</label>

		<label title='Fraction of farm time spent with an active turkimp.
0 = never, 1 = always, 1.5 = always + Turkimp Tamer III.'>
			<input type=text id=turkimp value='0.5'>
			Turkimp
		</label>

		<label title='Your usual breed timer'>
			<input type=text id=breed-timer value=30>
			Breed timer
		</label>

		<label title='Average number of coordinations you get from a gigastation'>
			<input type=text id=giga value=1>
			Coords per giga
		</label>

		<label title='Used in max pop calculations.
Increasing this reduces the importance of Carp, Resourceful and Trumps.'>
			<input type=text id=housing value=3>
			Housing thingy
		</label>

		</p>

		<button onclick='display(optimize(parse_inputs()))'>Optimize!</button>
	</fieldset>

	<div id=perks class=flexbox></div>
</form>

<nav class=flexbox>
	<a href='https://github.com/Grimy'>Made by Grimy</a>
	<a href='https://github.com/Grimy/Grimy.github.io/issues/new'>Report a bug</a>
	<a href='https://github.com/Grimy/Grimy.github.io/blob/master/perks.js'>View the source</a>
</nav>

<script src=trimps.js></script>
<script src=perks.js></script>
<script>

function input(id) {
	return parse_suffixes($('#' + id).value.toLowerCase());
}

function set_zone() {
	var zone = parseInt($('#zone').value);
	$('#weight-ok').parentNode.style.display = zone > 170 ? '' : 'none';
	$('#giga').parentNode.style.display = zone > 60 ? '' : 'none';
	$('#warning').style.display = zone > 200 ? '' : 'none';
	$('#unlock').value =
		zone >= 200 ? 'loot2' :
		zone >= 170 ? 'ok' :
		zone >= 150 ? 'reso' :
		zone >= 120 ? 'coord' :
		zone >= 115 ? 'sipho' :
		zone >=  70 ? 'anti' :
		zone >=  60 ? 'resi' :
		zone >=  45 ? 'medit' :
		zone >=  35 ? 'carp' :
		zone >=  33 ? 'relent' :
		zone >=  25 ? 'arti' :
		zone >=  20 ? 'range' :
		              'agility';

	$('#weight-breed').value = zone > 70 ? 0 : 1;
}

// TODO add checkboxes for Use Geneticist, Slow Done, Frugal Done, Sci V done
const parse_inputs = () => ({
	he_left: input('helium'),
	zone: parseInt($('#zone').value),
	last_unlock: $('#unlock').value,
	weight: {
		helium: input('weight-he'),
		attack: input('weight-atk'),
		health: input('weight-hp'),
		overkill: input('weight-ok'),
		breed: input('weight-breed'),
	},
	mod: {
		storage: 0.02,
		whip: $('#whipimp').checked,
		magn: $('#magnimp').checked,
		taunt: $('#tauntimp').checked,
		ven: $('#venimp').checked,
		chronojest: input('chronojest'),
		loot: input('loot'),
		turkimp: input('turkimp'),
		breed_timer: input('breed-timer'),
		giga: input('giga'),
		housing: input('housing'),
	}
});

function display(level) {
	var html = '';
	for (var perk of perks) {
		var capped = level[perk] == cap[perk] ? ' capped' : '';
		var tier2 = increment[perk] ? ' tier2' : '';
		html += `<div class='perk${capped}${tier2}'>${name[perk]}<br>${level[perk]}</div>`;
	}
	$('#perks').innerHTML = html;
}

const name = {
	loot2:   'Looting II',
	carp2:   'Carpentry II',
	moti2:   'Motivation II',
	power2:  'Power II',
	tough2:  'Toughness II',
	ok:      'Overkill',
	reso:    'Resourceful',
	coord:   'Coordinated',
	sipho:   'Siphonology',
	anti:    'Anticipation',
	resi:    'Resilience',
	medit:   'Meditation',
	relent:  'Relentlessness',
	carp:    'Carpentry',
	arti:    'Artisanistry',
	range:   'Range',
	agility: 'Agility',
	bait:    'Bait',
	trumps:  'Trumps',
	phero:   'Pheromones',
	packrat: 'Packrat',
	moti:    'Motivation',
	power:   'Power',
	tough:   'Toughness',
	loot:    'Looting',
};


set_zone();

</script>
